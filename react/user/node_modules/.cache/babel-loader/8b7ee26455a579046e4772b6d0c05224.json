{"ast":null,"code":"var _jsxFileName = \"/Users/vishalmahanteshkodagali/Documents/RMIT/Sem 3/Full Stack Development/Assignment/Git_s3895036/loop-web-s3904406/react/user/src/components/BookTickets.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { getLoggedInUserDetails } from \"../data/repository\";\nimport \"../Style/bookTickets.css\";\nimport { useNavigate } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { getUser } from \"../data/repository\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_HOST = \"http://localhost:4000/api\";\n\nconst BookTickets = _ref => {\n  _s();\n\n  let {\n    movie,\n    sessions\n  } = _ref;\n  const [ticketCount, setTicketCount] = useState(1);\n  const [selectedSession, setSelectedSession] = useState(0);\n  const [availableTickets, setAvailableTickets] = useState(0); // 0 for the first session, 1 for the second\n\n  const user = getLoggedInUserDetails();\n  const [message, setMessage] = useState(\"\"); // State for displaying messages\n\n  const navigate = useNavigate();\n\n  const goBack = movie => {\n    navigate(\"/\");\n  };\n\n  const handleSessionChange = async sessionId => {\n    if (sessionId !== \"None\") {\n      try {\n        const response = await axios.get(`${API_HOST}/sessions/` + sessionId); // Replace with the actual endpoint URL\n\n        setAvailableTickets(response.data.session_ticket_count); // Assuming the data is in response.data\n\n        setSelectedSession(sessionId);\n        console.log(selectedSession);\n        setMessage(\"\"); // Clear any previous messages\n      } catch (error) {\n        console.error(\"Error fetching movie reviews:\", error);\n      }\n    } else {\n      setSelectedSession(0);\n      setAvailableTickets(0);\n      setMessage(\"\"); // Clear any previous messages\n    }\n  };\n\n  const handleBookTickets = async () => {\n    if (selectedSession !== 0) {\n      if (availableTickets - ticketCount >= 0) {\n        const username = getUser();\n\n        try {\n          const reservationData = {\n            reservation_ticket_count: ticketCount,\n            username: username,\n            session_id: selectedSession\n          };\n          const response = await axios.post(`${API_HOST}/reservations`, reservationData);\n          await handleSessionChange(selectedSession);\n          setMessage(\"Reservation created successfully!\");\n        } catch (error) {\n          setMessage(\"We are experiencing a high load on our servers. Please try again later\");\n          console.log(\"Error creating reservation:\" + error);\n        }\n      } else {\n        setMessage(\"The number you selected is more than the available seats\");\n      }\n    } else {\n      setMessage(\"Please select a valid session\");\n    }\n  };\n\n  const handleTicketCountChange = e => {\n    const newCount = parseInt(e.target.value, 10);\n    setTicketCount(newCount);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"book-tickets\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Book Tickets\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"session-selection\",\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        children: \"Select Session:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        onChange: e => handleSessionChange(e.target.value),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"None\",\n          children: \"None\"\n        }, \"None\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 11\n        }, this), sessions.map(session => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: session.session_id,\n          children: session.session_time\n        }, session.session_time, false, {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ticket-count\",\n      children: [/*#__PURE__*/_jsxDEV(\"h6\", {\n        children: [\"Available Ticktes: \", availableTickets]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        children: \"Enter Ticket Count \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"number\",\n        value: ticketCount // Bind the input value to the state\n        ,\n        onChange: handleTicketCountChange // Update the state on input change\n\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"book-tickets-btn\",\n      onClick: handleBookTickets,\n      children: \"Book Tickets\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"back-tickets-btn\",\n      onClick: goBack,\n      children: \"Back\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }, this), message && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"message\",\n      style: {\n        color: message === \"Reservation created successfully!\" ? \"green\" : \"red\"\n      },\n      children: message\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 9\n    }, this), \"    \"]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 5\n  }, this);\n};\n\n_s(BookTickets, \"rySpr4b6inO/lwtzZd84iU+/Nto=\", false, function () {\n  return [useNavigate];\n});\n\n_c = BookTickets;\nexport default BookTickets;\n\nvar _c;\n\n$RefreshReg$(_c, \"BookTickets\");","map":{"version":3,"names":["React","useState","useEffect","getLoggedInUserDetails","useNavigate","axios","getUser","API_HOST","BookTickets","movie","sessions","ticketCount","setTicketCount","selectedSession","setSelectedSession","availableTickets","setAvailableTickets","user","message","setMessage","navigate","goBack","handleSessionChange","sessionId","response","get","data","session_ticket_count","console","log","error","handleBookTickets","username","reservationData","reservation_ticket_count","session_id","post","handleTicketCountChange","e","newCount","parseInt","target","value","map","session","session_time","color"],"sources":["/Users/vishalmahanteshkodagali/Documents/RMIT/Sem 3/Full Stack Development/Assignment/Git_s3895036/loop-web-s3904406/react/user/src/components/BookTickets.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { getLoggedInUserDetails } from \"../data/repository\";\nimport \"../Style/bookTickets.css\";\nimport { useNavigate } from \"react-router-dom\"; \nimport axios from \"axios\";\nimport { getUser} from \"../data/repository\";\n\nconst API_HOST = \"http://localhost:4000/api\";\n\nconst BookTickets = ({ movie,sessions }) => {\n \n  const [ticketCount, setTicketCount] = useState(1);\n  const [selectedSession, setSelectedSession] = useState(0);\n  const [availableTickets, setAvailableTickets] = useState(0); // 0 for the first session, 1 for the second\n  const user = getLoggedInUserDetails();\n  const [message, setMessage] = useState(\"\"); // State for displaying messages\n\n\n  const navigate = useNavigate();\n\n  const goBack = (movie) => {\n    navigate(\"/\");\n  }\n\n\n  const handleSessionChange = async (sessionId) => {\n    if(sessionId !== \"None\"){\n      try {\n        const response = await axios.get(`${API_HOST}/sessions/`+sessionId)// Replace with the actual endpoint URL\n        setAvailableTickets(response.data.session_ticket_count); // Assuming the data is in response.data\n        setSelectedSession(sessionId)\n        console.log(selectedSession)\n        setMessage(\"\"); // Clear any previous messages\n      } catch (error) {\n        console.error(\"Error fetching movie reviews:\", error);\n      }\n    }else{\n      setSelectedSession(0)\n      setAvailableTickets(0);\n      setMessage(\"\"); // Clear any previous messages\n    }\n    \n  };\n \n  const handleBookTickets = async () => { \n    if(selectedSession !== 0){\n      if ((availableTickets-ticketCount) >= 0){\n        const username = getUser()\n  \n        try {\n          const reservationData = {\n            reservation_ticket_count: ticketCount,\n            username: username,\n            session_id: selectedSession,\n          };\n          const response = await axios.post(`${API_HOST}/reservations`, reservationData);\n      \n          await handleSessionChange(selectedSession);\n          setMessage(\"Reservation created successfully!\");\n\n    \n\n        } catch (error) {\n          setMessage(\"We are experiencing a high load on our servers. Please try again later\");\n          console.log(\"Error creating reservation:\"+ error);\n\n        } \n      }else{\n        setMessage(\"The number you selected is more than the available seats\")\n      }\n    }else{\n      setMessage(\"Please select a valid session\")\n    }\n    \n    \n  };\n  const handleTicketCountChange = (e) => {\n    const newCount = parseInt(e.target.value, 10);\n    setTicketCount(newCount);\n  };\n\n  return (\n    <div className=\"book-tickets\">\n      <h2>Book Tickets</h2>\n      <div className=\"session-selection\">\n        <label>Select Session:</label>\n        <select\n          onChange={(e) => handleSessionChange(e.target.value)}\n        >\n          <option key=\"None\" value=\"None\">\n              None\n            </option>\n          {sessions.map((session) => (\n            <option key={session.session_time} value={session.session_id}>\n              {session.session_time}\n            </option>\n          ))}\n        </select>\n      </div>\n      <div className=\"ticket-count\">\n        <h6>Available Ticktes: {availableTickets}</h6>\n        <label>Enter Ticket Count </label>\n        <input\n          type=\"number\"\n          value={ticketCount} // Bind the input value to the state\n          onChange={handleTicketCountChange} // Update the state on input change\n        />\n      </div>\n      <button className=\"book-tickets-btn\" onClick={handleBookTickets}>Book Tickets</button>\n      <button className=\"back-tickets-btn\" onClick={goBack}>Back</button>\n      {message && (\n        <div className=\"message\" style={{ color: message === \"Reservation created successfully!\" ? \"green\" : \"red\" }}>\n          {message}\n        </div>\n      )}    </div>\n  );\n};\n\nexport default BookTickets;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}